import { BudError } from '@roots/bud-support/errors';
export const run = async function () {
    if (this.isProduction) {
        const compilation = await this.compiler
            ?.compile(this)
            .catch(this.catch);
        if (!compilation)
            return;
        compilation.run((error) => {
            compilation.close((error) => {
                if (!hasCompiler(this))
                    return;
                if (error)
                    this.catch(BudError.normalize(error));
            });
        });
    }
    if (this.isDevelopment && this.server)
        await this.server.run().catch(this.server.catch);
};
function hasCompiler(bud) {
    return bud.compiler !== undefined;
}
